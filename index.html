<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨å‹•ä½œç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button,input{font-size:14px;padding:8px 14px;margin:4px}
#tapBtn{font-size:26px;padding:28px 56px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:72px}
.player{font-size:60px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:999;font-size:18px;text-align:center;padding:20px}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>
ğŸ’° <span id="coin">0</span>
ğŸ’ <span id="dia">0</span>
â˜£ï¸ <span id="core">0</span>
âš” +<span id="atk">0</span>
</p>

<div class="player" id="player">ğŸ™‚</div>

<!-- ===== ã‚¬ãƒãƒ£ ===== -->
<button onclick="drawGacha()">ğŸ° é€šå¸¸</button>
<button onclick="draw10()">ğŸ° é€šå¸¸10é€£</button>
<button onclick="drawDia()">ğŸ’ ä¸Šä½</button>
<button onclick="drawDia10()">ğŸ’ ä¸Šä½10é€£</button>
<button onclick="drawNew()">ğŸ’ æ–°ã‚¬ãƒãƒ£</button>
<button onclick="drawNew10()">ğŸ’ æ–°ã‚¬ãƒãƒ£10é€£</button>
<button onclick="drawCore()">â˜£ï¸ ã‚³ã‚¢</button>
<button onclick="drawCore10()">â˜£ï¸ ã‚³ã‚¢10é€£</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<input id="diaNum" type="number" min="1" placeholder="ãƒ€ã‚¤ãƒ¤æ•°">
<button onclick="coinToDia()">ğŸ’°â†’ğŸ’</button>

<input id="coreNum" type="number" min="1" placeholder="ã‚³ã‚¢æ•°">
<button onclick="diaToCore()">ğŸ’â†’â˜£ï¸</button>

<hr>

<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>

<hr>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>

<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³',300,'ğŸ‘º',30)">ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',800,'ğŸ‘¹',80)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',3000,'ğŸ‰',300)">ãƒ‰ãƒ©ã‚´ãƒ³</button>

<hr><h3>ğŸ’ ãƒ€ã‚¤ãƒ¤ãƒœã‚¹</h3>
<button onclick="startBattle('é’æ™¶ã‚¹ãƒ©ã‚¤ãƒ (ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',1500,'ğŸ’',1,'dia')">é’æ™¶ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('çµæ™¶ã‚´ãƒ–ãƒªãƒ³(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',4000,'ğŸ’',2,'dia')">çµæ™¶ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('å®çŸ³ã‚ªãƒ¼ã‚¯(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',12000,'ğŸ’',3,'dia')">å®çŸ³ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('è¼ç«œ(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',40000,'ğŸ’',5,'dia')">è¼ç«œ</button>
<button onclick="startBattle('ç¥æ™¶ç«œ(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',120000,'ğŸ’',10,'dia')">ç¥æ™¶ç«œ</button>

<button onclick="startBattle('è¼çŸ³ã®é¨å£«(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',20000,'ğŸ’',0,15)">è¼çŸ³ã®é¨å£«</button>
<button onclick="startBattle('è’¼æ™¶ãƒ‰ãƒ©ã‚´ãƒ³(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',80000,'ğŸ’ ',0,20)">è’¼æ™¶ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç‹å† ç¥ç«œ(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',200000,'ğŸ‘‘',0,40)">ç‹å† ç¥ç«œ</button>
<button onclick="startBattle('è¼çŸ³ã®é¨å£«(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',2500000,'ğŸ’',0,45)">è¼çŸ³ã®é¨å£«</button>
<button onclick="startBattle('è’¼æ™¶ãƒ‰ãƒ©ã‚´ãƒ³(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',8000000,'ğŸ’ ',0,100)">è’¼æ™¶ãƒ‰ãƒ©ã‚´ãƒ³</button>

hr><h3>ğŸ’€ è¶…é«˜HPãƒœã‚¹</h3>
<button onclick="startBattle('è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ ',500000,'âš«',5000)">è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ç ´å£Šã‚´ãƒ–ãƒªãƒ³',1200000,'ğŸ’¥',12000)">ç ´å£Šã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯',3000000,'ğŸ”¥',35000)">ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç½å„ãƒ‰ãƒ©ã‚´ãƒ³',8000000,'ğŸ‰ğŸ”¥',120000)">ç½å„ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('å •å¤©ç¥ç«œ',20000000,'ğŸ˜ˆğŸ²',300000)">å •å¤©ç¥ç«œ</button>
<button onclick="startBattle('è™šç„¡ã®ã‚´ãƒ–ãƒªãƒ³',35000000,'âš«',400000)">è™šç„¡ã®ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ç ´æ»…ã‚ªãƒ¼ã‚¯',50000000,'ğŸ’¥',600000)">ç ´æ»…ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('çµ‚ç„‰ãƒ‰ãƒ©ã‚´ãƒ³',70000000,'ğŸ‰',900000)">çµ‚ç„‰ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('å •è½ç¥ç«œ',100000000,'ğŸ²',1300000)">å •è½ç¥ç«œ</button>
<button onclick="startBattle('æ·±æ·µã®ã‚¹ãƒ©ã‚¤ãƒ ',140000000,'âš«',1800000)">æ·±æ·µã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('å¥ˆè½ã‚´ãƒ–ãƒªãƒ³',200000000,'ğŸ‘¿',2500000)">å¥ˆè½ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('å†¥ç•Œã‚ªãƒ¼ã‚¯',280000000,'ğŸ‘¿',3500000)">å†¥ç•Œã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç ´å£Šç¥ãƒ‰ãƒ©ã‚´ãƒ³',400000000,'ğŸ‰ğŸ”¥',5000000)">ç ´å£Šç¥ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥æ®ºã—ã®ç«œ',600000000,'ğŸ²âœ¨',8000000)">ç¥æ®ºã—ã®ç«œ</button>
<button onclick="startBattle('è™šç©ºã®ç¥ç«œ',900000000,'â˜ ï¸',12000000)">è™šç©ºã®ç¥ç«œ</button>
<button onclick="startBattle('çµ‚æœ«ã®ã‚¹ãƒ©ã‚¤ãƒ ',1300000000,'â˜ ï¸',18000000)">çµ‚æœ«ã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('çµ¶æœ›ã‚´ãƒ–ãƒªãƒ³',1800000000,'â˜ ï¸',25000000)">çµ¶æœ›ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('æ»…ç•Œã‚ªãƒ¼ã‚¯',2500000000,'â˜ ï¸',35000000)">æ»…ç•Œã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç½ç¦ç¥ç«œ',3500000000,'â˜ ï¸',50000000)">ç½ç¦ç¥ç«œ</button>
<button onclick="startBattle('ä¸–ç•Œã‚’å–°ã‚‰ã†ç«œ',5000000000,'â˜ ï¸',80000000)">ä¸–ç•Œã‚’å–°ã‚‰ã†ç«œ

</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<p id="timer"></p>
<button id="tapBtn" onclick="tap()">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden" onclick="this.classList.add('hidden')"></div>

<script>
/* ===== DOM ===== */
const coinEl=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const coreEl=document.getElementById("core");
const atkEl=document.getElementById("atk");
const player=document.getElementById("player");
const select=document.getElementById("select");
const game=document.getElementById("game");
const bossName=document.getElementById("bossName");
const bossIcon=document.getElementById("bossIcon");
const hp=document.getElementById("hp");
const hpText=document.getElementById("hpText");
const overlay=document.getElementById("overlay");
const timerEl=document.getElementById("timer");
const diaNum=document.getElementById("diaNum");
const coreNum=document.getElementById("coreNum");

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let coin=+localStorage.getItem
("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let core=+localStorage.getItem("core")||0;
let atkBonus=+localStorage.getItem("atkBonus")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

/* ===== ä¿å­˜ãƒ»è¡¨ç¤ºæ›´æ–° ===== */
function save(){
  localStorage.setItem("coin",coin);
  localStorage.setItem("dia",dia);
  localStorage.setItem("core",core);
  localStorage.setItem("atkBonus",atkBonus);
  localStorage.setItem("dex",JSON.stringify(dex));
  coinEl.textContent=coin;
  diaEl.textContent=dia;
  coreEl.textContent=core;
  atkEl.textContent=atkBonus;
  player.textContent=
    atkBonus>=1000?"ğŸ‘‘ğŸ”¥":
    atkBonus>=100?"ğŸ˜âœ¨":"ğŸ™‚";
}
save();

/* ===== ã‚¬ãƒãƒ£è¨­å®š ===== */
function roll(table){
  let r=Math.random()*100, sum=0;
  for(const g of table){
    sum+=g[1];
    if(r<sum) return g;
  }
}

const normal=[
  ["R",50,1],
  ["SR",30,3],
  ["UR",15,10],
  ["LR",5,30]
];
const diaT=[
  ["UR",60,20],
  ["LR",40,60]
];
const newT=[
  ["DIVINE",50,100],
  ["DIVINEâ…¡",33,100],
  ["DIVINEâ…¢",17,1000]
];
const coreT=[
  ["ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰",40,500],
  ["ãƒ«ãƒ“ãƒ¼",35,600],
  ["ãƒ—ãƒ©ãƒãƒŠ",25,700]
];

function gain(g){
  atkBonus+=g[2];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  return `${g[0]} +${g[2]}`;
}

function show(msg){
  overlay.innerHTML=msg+"<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
  overlay.classList.remove("hidden");
}

/* ===== ã‚¬ãƒãƒ£å‡¦ç† ===== */
function drawGacha(){
  if(coin<100) return;
  coin-=100;
  show(gain(roll(normal)));
}
function draw10(){
  if(coin<1000) return;
  coin-=1000;
  let r="";
  for(let i=0;i<10;i++) r+=gain(roll(normal))+"<br>";
  show(r);
}
function drawDia(){
  if(dia<1) return;
  dia--;
  show(gain(roll(diaT)));
}
function drawDia10(){
  if(dia<10) return;
  dia-=10;
  let r="";
  for(let i=0;i<10;i++) r+=gain(roll(diaT))+"<br>";
  show(r);
}
function drawNew(){
  if(dia<100) return;
  dia-=100;
  show(gain(roll(newT)));
}
function drawNew10(){
  if(dia<1000) return;
  dia-=1000;
  let r="";
  for(let i=0;i<10;i++) r+=gain(roll(newT))+"<br>";
  show(r);
}
function drawCore(){
  if(core<1) return;
  core--;
  show(gain(roll(coreT)));
}
function drawCore10(){
  if(core<10) return;
  core-=10;
  let r="";
  for(let i=0;i<10;i++) r+=gain(roll(coreT))+"<br>";
  show(r);
}

/* ===== å¤‰æ› ===== */
function coinToDia(){
  const n=+diaNum.value;
  if(!n||coin<n*1000) return;
  coin-=n*1000;
  dia+=n;
  save();
  show(`ğŸ’ ãƒ€ã‚¤ãƒ¤ +${n}`);
}
function diaToCore(){
  const n=+coreNum.value;
  if(!n||dia<n*5) return;
  dia-=n*5;
  core+=n;
  save();
  show(`â˜£ï¸ ã‚³ã‚¢ +${n}`);
}

/* ===== å›³é‘‘ ===== */
function showDex(){
  let h="ğŸ“– å›³é‘‘<br>";
  for(const k in dex){
    h+=`${k} Ã— ${dex[k]}<br>`;
  }
  show(h);
}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp=0,maxHp=0,reward=0,rewardDia=0;
let rush=false,rushEnd=0,rushCount=0,rushHp=3000;

function startBattle(name,hpVal,icon,c=0,d=0){
  rush=false;
  bossName.textContent=name;
  bossIcon.textContent=icon;
  bossHp=maxHp=hpVal;
  reward=c;
  rewardDia=d;
  timerEl.textContent="";
  select.classList.add("hidden");
  game.classList.remove("hidden");
  updateHp();
}

function tap(){
  bossHp-=1+atkBonus;
  if(bossHp<=0){
    if(rush){
      rushCount++;
      nextRush();
    }else{
      coin+=reward;
      dia+=rewardDia;
      save();
      game.classList.add("hidden");
      select.classList.remove("hidden");
      show(`ğŸ‰ æ’ƒç ´ï¼<br>ğŸ’°+${reward} ğŸ’+${rewardDia}`);
    }
  }
  updateHp();
}

function updateHp(){
  hpText.textContent=Math.max(0,Math.ceil(bossHp));
  hp.style.width=(bossHp/maxHp*100)+"%";
}

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
function startRush(){
  rush=true;
  rushCount=0;
  rushHp=3000;
  rushEnd=Date.now()+60000;
  nextRush();
  select.classList.add("hidden");
  game.classList.remove("hidden");
}

function nextRush(){
  bossHp=maxHp=rushHp;
  bossName.textContent="ãƒ©ãƒƒã‚·ãƒ¥ãƒœã‚¹ "+(rushCount+1);
  bossIcon.textContent="ğŸ”¥";
  rushHp=Math.floor(rushHp*1.3);
  updateHp();
}

setInterval(()=>{
  if(!rush) return;
  const t=Math.ceil((rushEnd-Date.now())/1000);
  timerEl.textContent="æ®‹ã‚Š "+t+" ç§’";
  if(t<=0){
    rush=false;
    coin+=rushCount*500;
    save();
    game.classList.add("hidden");
    select.classList.remove("hidden");
    show(`ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº†<br>è¨ä¼ ${rushCount}<br>ğŸ’° +${rushCount*500}`);
  }
},200);
</script>
</body>
</html>
